pipeline:
  test:
    image: python:3.5
    pull: true
    environment:
      - DJANGO_SETTINGS_MODULE=django_project.settings.test
    commands:
      - pip install -U -r requirements.dev.txt
      - make lint
      - make full-test
    secrets:
      - ZINC_AWS_KEY
      - ZINC_AWS_SECRET
    volumes:
      - '/var/lib/drone/cache/pip:/root/.cache/pip'

  publish-docker-image:
    image: plugins/docker
    repo: presslabs/zinc
    tags: ${DRONE_BRANCH/master/latest}
    secrets:
      - docker_username
      - docker_password
    when:
      branch: master
